// Generated by CoffeeScript 1.6.3
(function() {
  var CHANNEL, PUBNUB, REDIS_ADDR, REDIS_HOST, REDIS_PORT, client, pubnub, redis,
    _this = this;

  PUBNUB = require('../deps/pubnub-javascript/node.js/pubnub.js');

  redis = require('../deps/node_redis/index.js');

  CHANNEL = process.argv[2];

  REDIS_ADDR = (process.argv[3] || 'localhost:6379').split(":");

  REDIS_HOST = REDIS_ADDR[0];

  REDIS_PORT = REDIS_ADDR[1];

  client = redis.createClient(REDIS_PORT, REDIS_HOST);

  pubnub = PUBNUB.init({
    subscribe_key: 'demo',
    publish_key: 'demo'
  });

  pubnub.subscribe({
    channel: CHANNEL,
    message: function(command) {
      var commandStr;
      commandStr = JSON.stringify(command);
      if (command.type === "entity") {
        console.log("updating redis with entity:", commandStr);
        return client.set(command.entity[1], command.entity[2]);
      } else {
        console.log("updating redis with command:", commandStr);
        return client.send_command(command.command, command.args);
      }
    }
  });

  console.log("Listening to PubNub redis channel \#" + CHANNEL + ", replaying to redis instance at " + REDIS_ADDR);

}).call(this);
